
aspect ReplaceInstanceValueAccess {

    public void ASTNode.replaceThisQualifierFor(MemberDecl method, Access byAccess){
        for(int i = 0; i < getNumChild(); i++)
            getChild(i).replaceThisQualifierFor(method, byAccess);
    }

    public void MethodAccess.replaceThisQualifierFor(MemberDecl method, Access byAccess){
        if(this.decl() == method){
            if(getQualifier() == null || getQualifier().isThisAccess())
                replace(this).with(new Dot(byAccess, this));
            else
                replace(getQualifier()).with(byAccess);
        }
    }

    public void VarAccess.replaceThisQualifierFor(MemberDecl field, Access byAccess){
        if(this.decl() == field){
            if(getQualifier() == null || getQualifier().isThisAccess())
                replace(this).with(new Dot(byAccess, this));
            else
                replace(getQualifier()).with(byAccess);
        }
    }

    public void ASTNode.replaceFieldAccess(FieldDeclarator oldUsed, Access newUsed) {
        for(int i = 0; i < getNumChild(); i++)
            getChild(i).replaceFieldAccess(oldUsed, newUsed);
    }
    public void VarAccess.replaceFieldAccess(FieldDeclarator oldUsed, Access newUsed) {
        if(decl().equals(oldUsed)){
            replace(this).with(newUsed);
        }
    }


    public void Callable.replaceMethodCall(MethodDecl oldUsed, MethodDecl newUsed){
        super.replaceMethodCall(oldUsed, newUsed);
    }

    public void ASTNode.replaceMethodCall(MethodDecl oldUsed, MethodDecl newUsed){
        for(int i = 0; i < getNumChild(); i++)
            getChild(i).replaceMethodCall(oldUsed, newUsed);
    }

    public void MethodAccess.replaceMethodCall(MethodDecl oldUsed, MethodDecl newUsed){
        if(this.decl() == oldUsed) {
            MethodAccess ma = new MethodAccess(newUsed.name(), this.getArgList());
            ma.setTargetMethod(new SavedMethodDecl(newUsed), this.isMonoCall);
        //        if(oldUsed.hostType() != newUsed.hostType())
            replace(this).with(ma);
        }
    }

}