import puck.graph.DGBuildingError;
import puck.graph.Tuple;
import puck.graph.Type;
import puck.graph.NamedType;

import puck.javaGraph.MethodType;
import scala.Some;

aspect TypeFactory {
	

	public abstract void BodyDecl.buildDGType(JavaGraphBuilder builder, int thisId);
	
	public void MemberTypeDecl.buildDGType(JavaGraphBuilder builder, int thisId){}
	public void StaticInitializer.buildDGType(JavaGraphBuilder builder, int thisId){}
	public void InstanceInitializer.buildDGType(JavaGraphBuilder builder, int thisId){}


	static void ASTNode.astParamsToDGType(JavaGraphBuilder builder, int thisId, Callable c){
//		System.out.println("building params of "+ c.fullName());
		ArrayList<Integer> params = new ArrayList<Integer>();

		for(ParameterDeclaration pdecl: c.getParameterList()){

			int agTypeNode = pdecl.getTypeAccess().buildDGNode(builder);
			int paramId = pdecl.buildDGNode(builder);
			params.add(paramId);
		 	builder.setType(paramId, new NamedType(agTypeNode));
		}
		builder.addParams(thisId, params);
	}

	public void FieldDecl.buildDGType(JavaGraphBuilder builder, int thisId){
		throw new DGBuildingError("missing type for FieldDecl");
	}
		
	public void MethodDecl.buildDGType(JavaGraphBuilder builder, int thisId){
		ASTNode.astParamsToDGType(builder, thisId, this);
		builder.setType(thisId, new NamedType(getTypeAccess().buildDGNode(builder)));
	}

	public void ConstructorDecl.buildDGType(JavaGraphBuilder builder, int thisId){
		ASTNode.astParamsToDGType(builder, thisId, this);
		builder.setType(thisId, new NamedType(hostType().buildDGNode(builder)));
	}

	public void FieldDeclaration.buildDGType(JavaGraphBuilder builder, int thisId){
		builder.setType(thisId, new NamedType(type().buildDGNode(builder)));
	}



}